SELECT * FROM (SELECT DISTINCT (p.sequence_no), s.description, 'notinhold' AS flag, s.priority FROM production_tracker p LEFT JOIN sequence_nos s ON (p.sequence_no = s.sequence_no) WHERE stage_completed_by IS NOT NULL AND p.sequence_no IN (SELECT DISTINCT sequence_no FROM production_tracker WHERE (work_center_id = '1' AND stage_completed_by IS NOT NULL)) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker WHERE (work_center_id = '4')) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker WHERE (work_center_id = '30')) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker_hold WHERE (unhold_dt IS NULL AND work_center_id = '4')) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker_rework WHERE (rework_complete IS NULL)) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker_building_18_rework WHERE (rework_complete IS NULL)) AND p.sequence_no IN (SELECT DISTINCT sequence_no FROM sequence_nos WHERE (is_active = 'Y')) UNION SELECT DISTINCT (p.sequence_no), s.description, 'hold' AS flag, s.priority FROM production_tracker p LEFT JOIN sequence_nos s ON (p.sequence_no = s.sequence_no) WHERE stage_completed_by IS NOT NULL AND p.sequence_no IN (SELECT DISTINCT sequence_no FROM production_tracker WHERE (work_center_id = '1' AND stage_completed_by IS NOT NULL)) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker WHERE (work_center_id = '4')) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker WHERE (work_center_id = '30')) AND p.sequence_no IN (SELECT DISTINCT sequence_no FROM production_tracker_hold WHERE (unhold_dt IS NULL AND work_center_id = '4')) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker_rework WHERE (rework_complete IS NULL)) AND p.sequence_no NOT IN (SELECT DISTINCT sequence_no FROM production_tracker_building_18_rework WHERE (rework_complete IS NULL)) AND p.sequence_no IN (SELECT DISTINCT sequence_no FROM sequence_nos WHERE (is_active = 'Y')) UNION SELECT * FROM (SELECT sequence_no, description, priority, 'notinhold' AS 'flag' FROM (SELECT DISTINCT sequence_no, description, priority FROM sequence_nos WHERE is_active = 'Y') tmp1 WHERE NOT EXISTS( SELECT pt.sequence_no FROM production_tracker pt WHERE (pt.sequence_no = tmp1.sequence_no)) AND NOT EXISTS( SELECT pth.sequence_no FROM production_tracker_hold pth WHERE (pth.work_center_id = '1' AND pth.unhold_dt IS NULL AND (pth.sequence_no = tmp1.sequence_no))) UNION SELECT sequence_no, description, priority, 'hold' AS 'flag' FROM (SELECT DISTINCT sequence_no, description, priority FROM sequence_nos WHERE is_active = 'Y') tmp1 WHERE NOT EXISTS( SELECT pt.sequence_no FROM production_tracker pt WHERE (pt.sequence_no = tmp1.sequence_no)) AND EXISTS( SELECT pth.sequence_no FROM production_tracker_hold pth WHERE (pth.work_center_id = '1' AND pth.unhold_dt IS NULL AND (pth.sequence_no = tmp1.sequence_no))) UNION SELECT tmp1.sequence_no, description, priority, 'notinhold' AS 'flag' FROM (SELECT DISTINCT sequence_no, description, priority FROM sequence_nos WHERE is_active = 'Y') tmp1 WHERE EXISTS( SELECT pt1.sequence_no FROM production_tracker pt1 WHERE pt1.work_center_id = '23' AND (pt1.sequence_no = tmp1.sequence_no)) AND NOT EXISTS( SELECT pt.sequence_no FROM production_tracker pt WHERE pt.work_center_id = '1' AND (pt.sequence_no = tmp1.sequence_no)) AND NOT EXISTS( SELECT pth.sequence_no FROM production_tracker_hold pth WHERE (pth.work_center_id = '1' AND pth.unhold_dt IS NULL AND (pth.sequence_no = tmp1.sequence_no))) UNION SELECT tmp1.sequence_no, description, priority, 'hold' AS 'flag' FROM (SELECT DISTINCT sequence_no, description, priority FROM sequence_nos WHERE is_active = 'Y') tmp1 WHERE EXISTS( SELECT pt1.sequence_no FROM production_tracker pt1 WHERE pt1.work_center_id = '23' AND (pt1.sequence_no = tmp1.sequence_no)) AND NOT EXISTS( SELECT pt.sequence_no FROM production_tracker pt WHERE pt.work_center_id = '1' AND (pt.sequence_no = tmp1.sequence_no)) AND EXISTS( SELECT pth.sequence_no FROM production_tracker_hold pth WHERE (pth.work_center_id = '1' AND pth.unhold_dt IS NULL AND (pth.sequence_no = tmp1.sequence_no)))) production_tracker ORDER BY priority , sequence_no) production_tracker ORDER BY priority , sequence_no